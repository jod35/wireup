<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Factory functions - WireUp</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Factory functions";
        var mkdocs_page_input_path = "factory_functions.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> WireUp
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../introduction/">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../parameters/">Parameters</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced Topics</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Factory functions</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#use-cases">Use cases</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#links">Links</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../interfaces/">Working with Interfaces</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../manual_configuration/">Manual configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../multiple_containers/">Multiple containers</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Misc</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../introduce_to_an_existing_project/">Introduce to an existing project</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../examples/fastapi/">FastAPI</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">WireUp</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Advanced Topics &raquo;</li>
      <li class="breadcrumb-item active">Factory functions</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="factory-functions">Factory functions</h1>
<p>Factory functions allow the container to wire dependencies that require additional logic to create 
or be able to inject objects it doesn't own.</p>
<p>Typically getting the necessary dependencies is enough to construct an object. However, there are scenarios
where you need to delegate the creation of an object to a special function called a 
<a href="https://en.wikipedia.org/wiki/Factory_(object-oriented_programming)">factory</a>.</p>
<h2 id="use-cases">Use cases</h2>
<p>Some of the use cases for factories are as follows:</p>
<ul>
<li>Object construction needs additional logic or configuration.</li>
<li>Depending on the runtime environment or configuration, you may need to create different objects 
inheriting from the same base (See <a href="https://en.wikipedia.org/wiki/Strategy_pattern">Strategy Pattern</a>) or configure them differently. </li>
<li>Gradually introduce DI into an existing project where the container should be able to inject dependencies created elsewhere. 
Such as injecting the same databaser connection as the rest of the application.</li>
<li>Eliminate services which have only one method that returns the same object and instead inject the object directly.<ul>
<li>A service that returns a db connection</li>
<li>A service which returns the current authenticated user</li>
<li>Register the result of a service's method as its own service. Instead of calling <code>auth_service.get_current_user()</code> every time, inject the authenticated user directly.</li>
</ul>
</li>
</ul>
<h2 id="usage">Usage</h2>
<p>In order for the container to be able to inject these dependencies you must register the factory function.
You can do this by using the <code>@container.register</code> decorator or by calling <code>container.register(fn)</code> directly.</p>
<p>When the container needs to inject a dependency it checks known factories to see if any of them can create it.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The return type of the function tells the container what type of dependency it can create.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Factories can only depend on objects known by the container!</p>
</div>
<h2 id="examples">Examples</h2>
<p>Assume in the context of a web application a class <code>User</code> exists and represents a user of the system.</p>
<pre><code class="language-python"># Instead of doing the following over and over again
def get_user_logs(auth_service: AuthService):
    current_user = auth_service.get_current_user()
    ...



# You can create a factory and inject the authenticated user directly.
# You may want to create a new type to make a disctinction on the type of user this is.
AuthenticatedUser = User

@container.register
def get_current_user(auth_service: AuthService) -&gt; AuthenticatedUser:
    return auth_service.get_current_user()

# Now it is possible to inject the authenticated user directly wherever it is necessary.
def get_user_logs(user: AuthenticatedUser):
    ...
</code></pre>
<h2 id="links">Links</h2>
<ul>
<li><a href="../introduce_to_an_existing_project/">Introduce to an existing project</a></li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../parameters/" class="btn btn-neutral float-left" title="Parameters"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../interfaces/" class="btn btn-neutral float-right" title="Working with Interfaces">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../parameters/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../interfaces/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
      <script src="../js/version-select.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
